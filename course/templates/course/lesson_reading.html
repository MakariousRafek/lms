<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>مرحلة القراءة - {{ lesson.title }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; padding-top: 50px; }
        .reading-box {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            font-size: 1.2rem;
            line-height: 1.8;
            margin-bottom: 30px;
        }
        .timer-box {
            font-size: 2rem;
            font-weight: bold;
            color: #dc3545; /* لون أحمر للتايمر */
            margin-bottom: 20px;
        }
        #quiz-btn { display: none; } /* مخفي لحد ما التايمر يخلص */
    </style>
</head>
<body>

<div class="container">
    <h2 class="text-center mb-4">مرحلة القراءة: {{ lesson.title }}</h2>

    <div class="text-center timer-box">
        الوقت المتبقي: <span id="time-display">--:--</span>
    </div>

    <div class="reading-box">
        {{ lesson.reading_text|linebreaks }}
    </div>

    <div class="text-center mb-5">
<a href="{% url 'lesson_quiz' lesson.id %}" id="quiz-btn" class="btn btn-primary btn-lg">بدء الاختبار (Quiz)</a>    </div>
</div>

<script>
    // بنجيب وقت التايمر من الداتابيز بالثواني
let timeLeft = parseInt("{{ lesson.reading_timer }}") * 60;
const displayElement = document.getElementById('time-display');
    const quizButton = document.getElementById('quiz-btn');

    function updateDisplay() {
        let minutes = Math.floor(timeLeft / 60);
        let seconds = timeLeft % 60;

        // عشان نظبط شكل الأرقام (مثلاً 09 بدل 9)
        if (seconds < 10) seconds = "0" + seconds;
        if (minutes < 10) minutes = "0" + minutes;

        displayElement.textContent = minutes + ":" + seconds;
    }

    // أول ما الصفحة تفتح نعرض الوقت فوراً
    updateDisplay();

    // تشغيل العداد كل ثانية (1000 ملي ثانية)
    const timerInterval = setInterval(function() {
        timeLeft--;
        updateDisplay();

        if (timeLeft <= 0) {
            clearInterval(timerInterval); // نوقف العداد
            displayElement.textContent = "00:00";
            displayElement.style.color = "#198754"; // نقلب اللون أخضر
            quizButton.style.display = "inline-block"; // نظهر زرار الكويز
        }
    }, 1000);
</script>

</body>
</html>